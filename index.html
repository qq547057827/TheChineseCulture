<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta name="description" content="汉服活动地点导航" />
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Cache-Control" content="max-age=300" />

    <title>汉服活动地点导航</title>
<style>
/*    body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
    #l-map {
        height: 300px;
        width: 100%;
    }

    #r-result, #r-result table {
        width: 100%;
        font-size: 12px;
    }*/
</style>
<!--加载百度 map api-->
<script src="http://api.map.baidu.com/api?v=2.0&ak=x6hKx3I2dg5mo5YowdD3pkKlkz4W85rZ"></script>  
<!-- <script src="http://developer.baidu.com/map/jsdemo/demo/convertor.js"></script> -->
</head>

<body>

<!-- <div id="l-map"></div>
<div id="r-result"></div> -->

<script type="text/javascript">
// var map = new BMap.Map("l-map");
function lodeSupport(){
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(updataPosition);
    }
}
function updataPosition(position){
    var latitudeP = position.coords.latitude,
        longitudeP = position.coords.longitude,
        accuracyP = position.coords.accuracy;
    
    var point = new BMap.Point(longitudeP , latitudeP);  // 创建点坐标  

    BMap.Convertor.translate(point,0,translateCallback);     //真实经纬度转成百度坐标
    
}
//坐标转换完之后的回调函数
function translateCallback(point1){
console.log(point1);
    // map.centerAndZoom(new BMap.Point(119.924605,28.440843), 12);
    // var p2 = new BMap.Point(119.924605,28.440843);

    // var transit = new BMap.TransitRoute(map, {
    //     renderOptions: { map: map, panel: "r-result" }
    // });
    // transit.search(point1, p2);
    var toHttp = 'http://api.map.baidu.com/direction?origin=latlng:'+ point1.lat +','+ point1.lng +'|name:我的位置&destination=latlng:28.440843,119.924605|name:丽水汉服活动位置&mode=transit&region=丽水&output=html&src=zhuzibaijia';
    // console.log(toHttp);
    location.href = toHttp;
}

window.addEventListener('load', lodeSupport , true);
</script>
</body>
</html>

<script>
    //2011-7-25
    (function(){        //闭包
    function load_script(xyUrl, callback){
        var head = document.getElementsByTagName('head')[0];
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = xyUrl;
        //借鉴了jQuery的script跨域方法
        script.onload = script.onreadystatechange = function(){
            if((!this.readyState || this.readyState === "loaded" || this.readyState === "complete")){
                callback && callback();
                // Handle memory leak in IE
                script.onload = script.onreadystatechange = null;
                if ( head && script.parentNode ) {
                    head.removeChild( script );
                }
            }
        };
        // Use insertBefore instead of appendChild  to circumvent an IE6 bug.
        head.insertBefore( script, head.firstChild );
    }
    function translate(point,type,callback){
        var callbackName = 'cbk_' + Math.round(Math.random() * 10000);    //随机函数名
        var xyUrl = "http://api.map.baidu.com/ag/coord/convert?from="+ type + "&to=4&x=" + point.lng + "&y=" + point.lat + "&callback=BMap.Convertor." + callbackName;
        //动态创建script标签
        load_script(xyUrl);
        BMap.Convertor[callbackName] = function(xyResult){
            delete BMap.Convertor[callbackName];    //调用完需要删除改函数
            var point = new BMap.Point(xyResult.x, xyResult.y);
            callback && callback(point);
        }
    }

    window.BMap = window.BMap || {};
    BMap.Convertor = {};
    BMap.Convertor.translate = translate;
    })();
</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?f205abb4984f47d6e9b9ac2e9415759c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>